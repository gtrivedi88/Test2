Hermetic builds
Hermetic builds refer to a controlled build process where all required resources and dependencies must pass through the build system. This strict control ensures that the build system has complete visibility and control over the dependencies needed for the build, including the ability to accurately collect, inquire, analyze, and manage all dependencies during the build process. By minimizing external dependencies and enforcing a centralized management approach, hermetic builds provide a predictable and reliable build environment.
Hermetic builds also focus on establishing a build pipeline that captures and maintains a precise record of the build’s origin, dependencies, and modifications. This emphasis on provenance allows for better traceability, reproducibility, and auditability of the build process. By having comprehensive visibility into the entire pipeline, hermetic builds enable the identification and resolution of issues, facilitate collaboration, and support long-term maintenance of the builds.
Enabling hermetic builds in {ProductName}
Prerequisites
For all components that you want to build hermetically, you have an upgraded build pipeline, which creates a `.tekton` folder in their repository.
You have vendored all dependencies in your component repository.

Procedures
For each component that you want to build hermetically:
Navigate to your component’s source code.
Open the `.tekton` directory and locate the `.yaml` files related to the `pull-request` and `push` processes.
Configure the hermetic pipeline: In both the `.yaml` files, add the following hermetic pipeline parameters.
param:
- name: prefetch-input
  	  value: “true”

Note: If you add this parameter in a non-java application, that is the Buildah task, the network access would be cut off. If you don’t have all the dependencies in your git repository or if you need more dependencies, then you can use pre-fetch dependencies to pull in the package manager dependencies for the supported languages. For now, we have support for Go and Pip. But soon, we will have support for other languages.



Pre-fetch builds
{ProductName} uses Cachi2 to prefetch the package manager dependencies for the supported languages.

Cachi2 is a wrapper around the package managers that makes it easy to configure hermetic builds. It also helps generate a manifest of all dependencies included in your builds, ensuring transparency and maintainability.

To ensure proper usage of Cachi2, follow these steps for your project’s builds process:

Define dependencies - Explicitly declare dependencies in a lock file generated by the package manager. Cachi2 only fetches dependencies that are declared in this file.
Reproducible builds - Cachi2 enforces exact version matching for dependencies, including transitive dependencies. This ensures a controlled and reproducible build environment.
Secure builds - While package managers use lock files to automatically resolve dependencies, it is crucial to verify the integrity of all the dependencies to safeguard against supply chain attacks.
Important: If your package manager supports specifying specific checks, you must use them. Cachi2 can perform verification checks if provided, but by default, they are not mandatory. 
Note: Achieving reliable and reproducible builds depends on the hermetic nature of the build process. Isolate the build from both internet and the underlying host system to avoid implicit dependencies, ensure reproducible behavior, and mitigate other issues. Cachi2 itself is not a hermetic build system. You must leverage existing technologies such as containers to achieve isolation and enhance the hermeticity of your builds.
Supported languages and subsequent package managers
The following table lists all the languages and subsequent package managers from which Cachi2 can prefetch the dependencies
Language
Package Manager
Golang
`gomod`
Node.js
`npm` or `yarn
Python
`pip`

Enabling pre-fetch builds
Prerequisites
For all components that you want to build hermetically, you have an upgraded build pipeline, which creates a `.tekton` folder in their repository.
You have dependencies outside of your git repository.

Procedures
For each component that you want to build hermetically:
Navigate to your component’s source code.
Open the `.tekton` directory and locate the `.yaml` files related to the `pull-request` and `push` processes.
Set up dependency prefetching with Cachi2: In both the `.yaml` files, add the prefetch-input pipeline parameter.
	param:
- name: prefetch-input
  Value: {package-manager} or {path-to-the-lock-file} <1>

<1> If your package manager lock file is in the root directory, you need to only enter the package manager name. However, if your package manager lock file is in a subdirectory, you need to add the path to the lock file of your package manager. 
